#!/bin/bash

# This script is used to prepare yum repositories, that are given as arguments.

set -e

function is_subscribed() {
  for f in /run/secrets/etc-pki-entitlement/*.pem ; do
    [ -e "$f" ] && return 0
    break
  done
  return 1
}

yum install -y yum-utils
if is_subscribed ; then
  # Disable only repos that might come from subscribed host, because there
  # might be other repos provided by user or build system
  echo "Disabling repositories rhel-\*"
  yum-config-manager --disable rhel-\* &> /dev/null
fi

if [ $# -gt 0 ] ; then
  yum-config-manager --enable "$@"
fi
